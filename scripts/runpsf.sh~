#!/bin/sh

<<<<<<< HEAD
KSBDIR=/home/cech/KSBf90
DATADIR=/disk1/cech/STAGES/RRG_update/images/scifits/
STARCATDIR=/disk1/cech/STAGES/RRG_update/images/stars/starcats/
CATDIR=/disk1/cech/STAGES_image_analysis/images/SExcats/
OUTDIR=/disk1/cech/STAGES/RRG_update/OUTDATA/PSF
=======
KSBDIR=/home/cajd/Size_Measurements/src/
DATADIR=/disk2/cech/STAGES_image_analysis/images/scifits/
STARCATDIR=/disk2/cech/STAGES_image_analysis/stars/starcats/
CATDIR=/disk2/cech/STAGES_image_analysis/images/SExcats/
>>>>>>> 32bf0a34db9681b84d0e393d5a509fd884e1c201
fitshead=a901-
fitstail=-sci.fits
starcattail=.chosen_stars.cat
sexcattail=-ab.cat

<<<<<<< HEAD
# first create image lists in 7 groups 
# Groups based on HST observation dates (see Fig 1 of Heymans et al 2008)

for obs_group in 1 2 3 4 5 6 7
do 

    # write out image location

    while read tile grp
    do
	if [ $grp = $obs_group ]; then

	    echo $DATADIR/$fitshead$tile$fitstail
	fi
    done < tile_group.dat  >  IM_CAT_LISTS/image.list.$obs_group

    # write out catalogue location

    while read tile grp
    do
	if [ $grp = $obs_group ]; then

	    echo $CATDIR/$fitshead$tile$sexcattail

	fi
    done < tile_group.dat  >  IM_CAT_LISTS/cat.list.$obs_group


    # count the number of images in each group
    COUNTER=`wc -l IM_CAT_LISTS/cat.list.$obs_group | awk '{print $1}'`
    
    i=01

    # RUN psffit for each group to create PSF models

    $KSBDIR/psffit.a -nimage $COUNTER -image IM_CAT_LISTS/image.list.$obs_group -in IM_CAT_LISTS/cat.list.$obs_group -crit $STARCATDIR/$fitshead$i$starcattail -param KSBf90.param -pgopen /xwin -out OUTDIR/STAGES_PSF.$obs_group.dat

done

=======
# first create image lists

#for file in $DATADIR/*
#do
#echo $file 
#done > image.list

#for file in $CATDIR/*$sexcattail
#do 
#echo $file
#done > cat.list

i=01
#$KSBDIR/psffit.a -nimage 1 -image $DATADIR/$fitshead$i$fitstail -in $CATDIR/$fitshead$i$sexcattail -crit $STARCATDIR/$fitshead$i$starcattail -param KSBf90.param -pgopen /xwin -out PSF.dat

#$KSBDIR/psffit.a -nimage 3 -image image.list -in cat.list -crit $STARCATDIR/$fitshead$i$starcattail -param KSBf90.param -pgopen /xwin -out PSF.dat

# single image - hardwired to disk1 until disk2 faults corrected

$KSBDIR/psffit -nimage 1 -image /home/cech/a901-01-sci.fits -in /home/cajd/Size_Measurements/test_data/a901-01-ab.cat -crit  /home/cajd/Size_Measurements/test_data/a901-01.chosen_stars.cat -param KSBf90.param -pgopen /xwin -out PSF.dat
>>>>>>> 32bf0a34db9681b84d0e393d5a509fd884e1c201
